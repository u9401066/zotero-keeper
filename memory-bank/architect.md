# Architecture Document

> ğŸ—ï¸ ç³»çµ±æ¶æ§‹è¨­è¨ˆæ–‡ä»¶

## æ¶æ§‹ç¸½è¦½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        VS Code Extension                         â”‚
â”‚                    (vscode-zotero-mcp v0.3.1)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ MCP Protocol (stdio)
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   zotero-keeper      â”‚              â”‚   pubmed-search-mcp  â”‚
â”‚    (MCP Server)      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    (MCP Server)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   PubMed     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚               Mapper                 â”‚
           â”‚                                      â”‚
           â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Zotero Local API   â”‚              â”‚   NCBI Entrez API    â”‚
â”‚   (localhost:23119)  â”‚              â”‚   iCite, MeSH        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## DDD åˆ†å±¤æ¶æ§‹ (ç¬¦åˆæ†²æ³•ç¬¬ 1 æ¢)

### 1. Domain Layer (æ ¸å¿ƒå±¤)
```
domain/
â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ reference.py      # æ–‡ç»åƒè€ƒå¯¦é«” (182 è¡Œ âœ…)
â”‚   â”œâ”€â”€ collection.py     # æ”¶è—å¤¾å¯¦é«” (41 è¡Œ âœ…)
â”‚   â””â”€â”€ batch_result.py   # æ‰¹æ¬¡çµæœå¯¦é«” (211 è¡Œ âœ…)
```

**è²¬ä»»**:
- å®šç¾©æ ¸å¿ƒæ¥­å‹™å¯¦é«”
- å¯¦ä½œæ¥­å‹™é‚è¼¯å’Œé©—è­‰è¦å‰‡
- ä¸ä¾è³´ä»»ä½•å¤–éƒ¨å¥—ä»¶

### 2. Infrastructure Layer (åŸºç¤è¨­æ–½å±¤)
```
infrastructure/
â”œâ”€â”€ zotero_client/
â”‚   â””â”€â”€ client.py         # Zotero API å®¢æˆ¶ç«¯ (618 è¡Œ âš ï¸ éœ€æ‹†åˆ†)
â”œâ”€â”€ mappers/
â”‚   â””â”€â”€ pubmed_mapper.py  # PubMed â†’ Zotero æ˜ å°„ (325 è¡Œ âœ…)
â”œâ”€â”€ pubmed/
â”‚   â””â”€â”€ __init__.py       # PubMed æ•´åˆ (268 è¡Œ âœ…)
â””â”€â”€ mcp/
    â”œâ”€â”€ server.py         # MCP Server (586 è¡Œ âš ï¸ éœ€æ‹†åˆ†)
    â”œâ”€â”€ search_tools.py   # æœå°‹å·¥å…· (604 è¡Œ âš ï¸ éœ€æ‹†åˆ†)
    â”œâ”€â”€ batch_tools.py    # æ‰¹æ¬¡å·¥å…· (469 è¡Œ âš ï¸ éœ€æ‹†åˆ†)
    â”œâ”€â”€ smart_tools.py    # æ™ºæ…§å·¥å…· (224 è¡Œ âœ…)
    â”œâ”€â”€ pubmed_tools.py   # PubMed å·¥å…· (433 è¡Œ âš ï¸ éœ€æ‹†åˆ†)
    â”œâ”€â”€ interactive_tools.py # äº’å‹•å·¥å…· (816 è¡Œ âš ï¸ éœ€æ‹†åˆ†)
    â”œâ”€â”€ saved_search_tools.py # å„²å­˜æœå°‹ (228 è¡Œ âœ…)
    â””â”€â”€ resources.py      # MCP è³‡æº (300 è¡Œ âœ…)
```

## å¾…é‡æ§‹æ¸…å–® (é•å bylaws/ddd-architecture.md ç¬¬ 3 æ¢)

| æª”æ¡ˆ | è¡Œæ•¸ | å„ªå…ˆç´š | æ‹†åˆ†å»ºè­° |
|------|------|--------|----------|
| `interactive_tools.py` | 816 | P1 | â†’ `interactive/validation.py` + `interactive/duplicate.py` |
| `client.py` | 618 | P1 | â†’ `client/read.py` + `client/write.py` |
| `search_tools.py` | 604 | P2 | â†’ `search/basic.py` + `search/advanced.py` |
| `server.py` | 586 | P2 | â†’ `server/core.py` + `server/tools.py` |
| `batch_tools.py` | 469 | P3 | â†’ `batch/add.py` + `batch/validate.py` |
| `pubmed_tools.py` | 433 | P3 | â†’ `pubmed/import.py` + `pubmed/search.py` |

## æ¶æ§‹æ±ºç­–

### ADR-001: ä½¿ç”¨ FastMCP æ¡†æ¶
- **æ±ºç­–**: ä½¿ç”¨ FastMCP è€Œéæ‰‹å‹•å¯¦ä½œ MCP
- **ç†ç”±**: ç°¡åŒ– tool å®šç¾©ï¼Œè‡ªå‹•è™•ç†å”å®š

### ADR-002: DDD åˆ†å±¤ä½†ä¸éåº¦
- **æ±ºç­–**: ç°¡åŒ– DDDï¼Œçœç•¥ Application Service å±¤
- **ç†ç”±**: å°ˆæ¡ˆè¦æ¨¡ä¸å¤§ï¼Œé¿å…éåº¦å·¥ç¨‹åŒ–

### ADR-003: PubMed Mapper ç½®æ–¼ Infrastructure
- **æ±ºç­–**: `pubmed_mapper.py` æ”¾åœ¨ infrastructure/mappers
- **ç†ç”±**: è² è²¬å¤–éƒ¨ API è³‡æ–™æ ¼å¼è½‰æ›ï¼Œéæ ¸å¿ƒæ¥­å‹™é‚è¼¯

### ADR-004: å„ªå…ˆä½¿ç”¨ uv
- **æ±ºç­–**: ä½¿ç”¨ uv ç®¡ç† Python ç’°å¢ƒ (ç¬¦åˆ bylaws/python-environment.md)
- **ç†ç”±**: æ›´å¿«çš„å¥—ä»¶å®‰è£é€Ÿåº¦ï¼Œæ›´å¥½çš„é–å®šæ©Ÿåˆ¶

---

## ä¸‹ä¸€æ­¥æ¶æ§‹æ”¹é€²

1. **æ‹†åˆ†å¤§æª”æ¡ˆ**: ä¾æ“šä¸Šè¡¨æ‹†åˆ†è¶…é 400 è¡Œçš„æª”æ¡ˆ
2. **å¢åŠ  Application Layer**: å¦‚æœæ¥­å‹™é‚è¼¯è®Šè¤‡é›œï¼Œè€ƒæ…®åŠ å…¥ services/
3. **Repository Pattern**: åœ¨ Domain å’Œ Infrastructure ä¹‹é–“åŠ å…¥æŠ½è±¡

---
*Updated: 2025-12-16*
*ç¬¦åˆ: CONSTITUTION.md ç¬¬ 1, 2 æ¢*
